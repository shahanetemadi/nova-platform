<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
let provider, signer, userAddress;

async function connectWallet() {
  try {
    let ethProvider = null;

    if (window.ethereum) {
      ethProvider = window.ethereum;
    } else if (window.safepal && window.safepal.ethereum) {
      ethProvider = window.safepal.ethereum;
    } else if (window.BinanceChain) {
      ethProvider = window.BinanceChain;
    } else {
      alert("❌ لطفاً سایت را فقط از داخل SafePal → Discover باز کنید");
      return;
    }

    provider = new ethers.providers.Web3Provider(ethProvider, "any");

    await provider.send("eth_requestAccounts", []);

    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    document.getElementById("walletStatus").innerText =
      "✅ Connected: " + userAddress.slice(0,6) + "..." + userAddress.slice(-4);

    console.log("Wallet Connected:", userAddress);

  } catch (e) {
    console.error(e);
    alert("❌ اتصال رد شد یا کنسل شد");
  }
}
</script>
