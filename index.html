<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
let provider, signer, userAddress;

async function connectWallet() {
  try {
    if (typeof window.ethereum === "undefined") {
      alert("❌ لطفاً سایت را فقط از داخل SafePal (Discover) باز کنید");
      return;
    }

    provider = new ethers.providers.Web3Provider(window.ethereum, "any");

    // درخواست اتصال
    await provider.send("eth_requestAccounts", []);

    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    document.getElementById("walletStatus").innerText =
      "✅ Connected: " + userAddress.slice(0,6) + "..." + userAddress.slice(-4);

    console.log("Connected:", userAddress);
  } catch (err) {
    console.error(err);
    alert("❌ اتصال انجام نشد، یک بار صفحه را رفرش کنید");
  }
}
</script>
