<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NOVA Platform</title>

<!-- Web3 -->
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

<style>
:root{
  --bg:#0b0f1a;
  --card:#121a2f;
  --accent:#00f0ff;
  --text:#e6e6e6;
  --muted:#9aa4bf;
}
body{
  margin:0;
  font-family:Tahoma,Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:16px;
  background:#0f1629;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  background:var(--accent);
  border:none;
  padding:10px 16px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
.container{
  padding:16px;
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
h2{margin-top:0}
.value{color:var(--accent);font-weight:bold}
.lang{
  background:none;
  color:var(--text);
  border:1px solid var(--accent);
  margin-left:8px;
}
.hidden{display:none}
table{
  width:100%;
  border-collapse:collapse;
}
td,th{
  padding:8px;
  border-bottom:1px solid #222;
  text-align:left;
}
</style>
</head>

<body>

<header>
  <div>üöÄ <b>NOVA PLATFORM</b></div>
  <div>
    <button class="lang" onclick="setLang('fa')">FA</button>
    <button class="lang" onclick="setLang('en')">EN</button>
    <button onclick="connectWallet()">Connect Wallet</button>
  </div>
</header>

<div class="container">

<!-- USER DASHBOARD -->
<div class="card">
  <h2 id="t_dashboard">ÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ ⁄©ÿßÿ±ÿ®ÿ±</h2>
  <p>Wallet: <span id="wallet" class="value">-</span></p>
  <p>User Count: <span id="userCount" class="value">-</span></p>
</div>

<!-- LEADERBOARD -->
<div class="card">
  <h2 id="t_leaderboard">üèÜ ŸÑ€åÿØÿ±ÿ®Ÿàÿ±ÿØ</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>UserID</th>
        <th>UNI</th>
        <th>BI</th>
      </tr>
    </thead>
    <tbody id="leaderboard">
      <tr><td colspan="4">Loading...</td></tr>
    </tbody>
  </table>
</div>

<!-- ADMIN PANEL -->
<div class="card hidden" id="adminPanel">
  <h2>üîê Admin Panel</h2>
  <p>Total Users: <span id="adminUserCount" class="value">-</span></p>
</div>

</div>

<script>
// ================= CONFIG =================
const CONTRACT_ADDRESS = "0x3810099D2D61e0399d07a3bad4e796A3De82ff27";
const ADMIN_WALLET = "PUT_ADMIN_WALLET_HERE"; // <-- ÿ®ÿπÿØÿßŸã ÿ¢ÿØÿ±ÿ≥ ÿÆŸàÿØÿ™
const TELEGRAM_BOT_TOKEN = "8453158537:AAFbEyrj967B55LZn5IFdhcXA5fA7bmUS4Y";
const TELEGRAM_CHAT_ID = "@Novacompany_bot";

// ABI (ÿÆŸÑÿßÿµŸá‚Äåÿ¥ÿØŸá ÿ®ÿ±ÿß€å ŸÅÿßÿ≤ 1)
const ABI = [
 {"inputs":[],"name":"UserCount","outputs":[{"internalType":"uint256","name":"count","type":"uint256"}],"stateMutability":"view","type":"function"},
 {"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"idToTotalEarned","outputs":[
   {"internalType":"uint256","name":"uniUsd","type":"uint256"},
   {"internalType":"uint256","name":"biUsd","type":"uint256"},
   {"internalType":"uint256","name":"vou","type":"uint256"},
   {"internalType":"uint256","name":"mileUsd","type":"uint256"}
 ],"stateMutability":"view","type":"function"}
];

let web3, contract, currentAccount=null;
let LANG="fa";

// ================= LANG =================
const TEXT={
 fa:{
  dashboard:"ÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ ⁄©ÿßÿ±ÿ®ÿ±",
  leaderboard:"ŸÑ€åÿØÿ±ÿ®Ÿàÿ±ÿØ"
 },
 en:{
  dashboard:"User Dashboard",
  leaderboard:"Leaderboard"
 }
};
function setLang(l){
 LANG=l;
 document.getElementById("t_dashboard").innerText=TEXT[l].dashboard;
 document.getElementById("t_leaderboard").innerText=TEXT[l].leaderboard;
}

// ================= WALLET =================
async function connectWallet(){
 if(!window.ethereum){
   alert("Wallet not found (SafePal / MetaMask)");
   return;
 }
 web3=new Web3(window.ethereum);
 const accs=await ethereum.request({method:"eth_requestAccounts"});
 currentAccount=accs[0];
 document.getElementById("wallet").innerText=currentAccount;
 contract=new web3.eth.Contract(ABI,CONTRACT_ADDRESS);

 if(currentAccount.toLowerCase()===ADMIN_WALLET.toLowerCase()){
   document.getElementById("adminPanel").classList.remove("hidden");
 }

 notifyTelegram("Wallet Connected:\n"+currentAccount);
 loadData();
}

// ================= LOAD DATA =================
async function loadData(){
 const count=await contract.methods.UserCount().call();
 document.getElementById("userCount").innerText=count;
 document.getElementById("adminUserCount").innerText=count;

 loadLeaderboard(count);
}

// ================= LEADERBOARD =================
async function loadLeaderboard(count){
 let tbody=document.getElementById("leaderboard");
 tbody.innerHTML="";
 let limit=Math.min(count,5);
 for(let i=1;i<=limit;i++){
   let e=await contract.methods.idToTotalEarned(i).call();
   let tr=document.createElement("tr");
   tr.innerHTML=`
    <td>${i}</td>
    <td>${i}</td>
    <td>${e.uniUsd}</td>
    <td>${e.biUsd}</td>`;
   tbody.appendChild(tr);
 }
}

// ================= TELEGRAM =================
function notifyTelegram(msg){
 fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({
    chat_id:TELEGRAM_CHAT_ID,
    text:"üöÄ NOVA PLATFORM\n"+msg
  })
 });
}
</script>

</body>
</html>
